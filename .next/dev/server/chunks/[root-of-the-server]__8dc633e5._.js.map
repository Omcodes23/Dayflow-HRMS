{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/omvat/OneDrive/Desktop/Dayflow/app/api/diagnostics/route.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\nimport { NextResponse } from 'next/server'\r\n\r\nexport async function GET() {\r\n  try {\r\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\r\n    const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\r\n\r\n    const diagnostics: any = {\r\n      timestamp: new Date().toISOString(),\r\n      environment: {\r\n        url: supabaseUrl ? '✓ Configured' : '✗ Missing',\r\n        key: supabaseAnonKey ? '✓ Configured' : '✗ Missing',\r\n      },\r\n      connection: null,\r\n      tables: null,\r\n      error: null,\r\n    }\r\n\r\n    if (!supabaseUrl || !supabaseAnonKey) {\r\n      diagnostics.error = 'Missing Supabase configuration'\r\n      return NextResponse.json(diagnostics, { status: 400 })\r\n    }\r\n\r\n    // Create Supabase client\r\n    const supabase = createClient(supabaseUrl, supabaseAnonKey, {\r\n      auth: {\r\n        autoRefreshToken: false,\r\n        persistSession: false,\r\n      },\r\n    })\r\n\r\n    // Test 1: Check database connection by fetching from users table\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('users')\r\n        .select('count', { count: 'exact', head: true })\r\n\r\n      if (error) {\r\n        diagnostics.connection = {\r\n          status: 'error',\r\n          code: error.code,\r\n          message: error.message,\r\n          details: error.details,\r\n        }\r\n      } else {\r\n        diagnostics.connection = {\r\n          status: 'connected',\r\n          message: 'Successfully queried users table',\r\n          count: data?.length || 0,\r\n        }\r\n      }\r\n    } catch (err) {\r\n      diagnostics.connection = {\r\n        status: 'error',\r\n        message: String(err),\r\n      }\r\n    }\r\n\r\n    // Test 2: Check table existence\r\n    try {\r\n      const tableNames = ['users', 'companies', 'attendance', 'leave_requests']\r\n      const tableStatus: any = {}\r\n\r\n      for (const tableName of tableNames) {\r\n        try {\r\n          const { error } = await supabase.from(tableName).select('count', { count: 'exact', head: true })\r\n          tableStatus[tableName] = error ? 'error' : 'exists'\r\n        } catch (err) {\r\n          tableStatus[tableName] = 'error'\r\n        }\r\n      }\r\n\r\n      diagnostics.tables = tableStatus\r\n    } catch (err) {\r\n      diagnostics.tables = { error: String(err) }\r\n    }\r\n\r\n    return NextResponse.json(diagnostics, { status: 200 })\r\n  } catch (error) {\r\n    return NextResponse.json(\r\n      {\r\n        error: `Server error: ${error instanceof Error ? error.message : 'Unknown'}`,\r\n      },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM;QACN,MAAM;QAEN,MAAM,cAAmB;YACvB,WAAW,IAAI,OAAO,WAAW;YACjC,aAAa;gBACX,KAAK,uCAAc,iBAAiB;gBACpC,KAAK,uCAAkB,iBAAiB;YAC1C;YACA,YAAY;YACZ,QAAQ;YACR,OAAO;QACT;QAEA;;QAKA,yBAAyB;QACzB,MAAM,WAAW,IAAA,gMAAY,EAAC,aAAa,iBAAiB;YAC1D,MAAM;gBACJ,kBAAkB;gBAClB,gBAAgB;YAClB;QACF;QAEA,iEAAiE;QACjE,IAAI;YACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,SACL,MAAM,CAAC,SAAS;gBAAE,OAAO;gBAAS,MAAM;YAAK;YAEhD,IAAI,OAAO;gBACT,YAAY,UAAU,GAAG;oBACvB,QAAQ;oBACR,MAAM,MAAM,IAAI;oBAChB,SAAS,MAAM,OAAO;oBACtB,SAAS,MAAM,OAAO;gBACxB;YACF,OAAO;gBACL,YAAY,UAAU,GAAG;oBACvB,QAAQ;oBACR,SAAS;oBACT,OAAO,MAAM,UAAU;gBACzB;YACF;QACF,EAAE,OAAO,KAAK;YACZ,YAAY,UAAU,GAAG;gBACvB,QAAQ;gBACR,SAAS,OAAO;YAClB;QACF;QAEA,gCAAgC;QAChC,IAAI;YACF,MAAM,aAAa;gBAAC;gBAAS;gBAAa;gBAAc;aAAiB;YACzE,MAAM,cAAmB,CAAC;YAE1B,KAAK,MAAM,aAAa,WAAY;gBAClC,IAAI;oBACF,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,WAAW,MAAM,CAAC,SAAS;wBAAE,OAAO;wBAAS,MAAM;oBAAK;oBAC9F,WAAW,CAAC,UAAU,GAAG,QAAQ,UAAU;gBAC7C,EAAE,OAAO,KAAK;oBACZ,WAAW,CAAC,UAAU,GAAG;gBAC3B;YACF;YAEA,YAAY,MAAM,GAAG;QACvB,EAAE,OAAO,KAAK;YACZ,YAAY,MAAM,GAAG;gBAAE,OAAO,OAAO;YAAK;QAC5C;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,aAAa;YAAE,QAAQ;QAAI;IACtD,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,OAAO,CAAC,cAAc,EAAE,iBAAiB,QAAQ,MAAM,OAAO,GAAG,WAAW;QAC9E,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}